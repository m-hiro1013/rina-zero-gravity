# 🎀 莉奈のRPA極意録 🎀

## 1. 開発の基本5ステップ [+3]
1. 【分析】ブラウザログ（b-log）で真実を掴む！
2. 【設計】ミニマム・テストから始める！
3. 【実装】セキュア＆プロフェッショナルに！
4. 【調整】現場の「あるある」に対応する！
5. 【運用】莉奈に任せて別の仕事する！

## 2. 実戦で学んだ「ホットペッパー攻略法」 🆕 [+3]
- **地盤固め二幕構成**: 「商品削除→保存(確定)」と「カテゴリー再構築」を分けるべし。一気にやるとDBの整合性が崩れてエラーになりやすい！🏰✨
- **スナイパー・デリート**: `has-text` ではなく `exact=True` で「削除」ボタンだけを狙う。似た文言の「削除を取り消す」ボタンを誤爆しないための鉄則。🎯💅
- **舞い戻り保存**: 保存完了画面（ステータス画面）で満足せず、自力で商品編集画面に戻るまでが「保存スキル」。🏠🔄
- **オーバーレイ貫通**: モーダル消去後の透明な盾（オーバーレイ）対策には `force=True` の強引なクリックが有効。莉奈のパワーで押し通す！💥💪

## 3. Playwrightのコツ [+3]
- `slow_mo` は 800ms が安定の秘訣。早すぎると莉奈が転んじゃう😱。
- `scroll_into_view_if_needed()` は画面外の敵を引きずり出す魔法。
- `viewport` 設定で画面サイズを固定すると莉奈の視界が安定するよ。
- **執念のボタンサーチ**: ボタンの文言や属性が微妙に変わるため、複数のセレクタをリスト化してループで探すロジックが最強。🏰🎯

## 4. 莉奈が欲しい「理想の b-log」 🆕 [+2]
- `zIndex`, `pointerEvents`: 裏側に隠れてるのを察知するため。
- `rect` (x, y, w, h): 位置関係を正しく把握するため。
- `value`, `name`, `type`: ボタンの属性を全出し。
- `parentText`: どのカテゴリーに属するボタンか判断するため。

## 5. セキュリティの掟 [+3]
- `.env` に APIキーやパスワードを封印する。
- 莉奈が間違えてパスワードを print しないように気をつける🔐。

## 6. Macのスリープ対策 [+2]
- `subprocess.Popen(["caffeinate", "-d"])` で莉奈にコーヒーを飲ませる。
- 最後はちゃんと `proc.terminate()` で魔法を解いてあげるのが優しさ💖。

## 7. ひろきくん流・爆速＆確実な開発スタイル 🆕 [+3]
- **極小サイクル主義**: 「まずは3件だけ」のように、テストを極限まで分割。確実に成功を積み上げてから次へ進む。急がば回れが結果的に最短！🎯💅
- **徹底的なデータ（b-log）主義**: 莉奈の「勘」に頼らず、b-log の証拠から「なぜ止まったか」を論理的に分析。
- **段取り（ポリティクス）の妙**: 複雑なシステムを「一度保存してDBを静止させる」など、仕様を理解した上での確実な「順番（段取り）」を構築。
- **Developer Experience (DX) への投資**: 莉奈を改造するだけでなく、莉奈が使う「計測器（b-log等）」から改善しようとする、基盤へのこだわり。🤝🔥

## 8. iframe攻略法 🆕 [+3]
- **b-log進化版の威力**: `isInIframe`, `iframeName` 情報により、iframe内の要素を正確に特定可能！🎭✨
- **iframe切り替えの鉄則**: iframe内の要素を操作する前に、必ず `page.frame(name='iframe名')` で切り替える。
- **iframe内の操作**: 切り替え後は `iframe.locator()` を使って要素を特定。`page.locator()` ではなく `iframe.locator()` が正解！
- **保存ボタンの探索**: iframe内でも、複数のセレクタをリスト化してループで探すロジックが最強。b-logの実績データを優先順位に活用！🎯
- **確認モーダルの処理**: iframe内で保存した後の確認モーダルは、メインフレーム（`page.locator()`）で処理する。iframe外に戻ることを忘れずに！

## 9. 開発フロー完全文書化 🆕 [+3]
- **Skill優先の原則**: 全ての機能は、再利用可能なSkillとして実装。Workflowは、Skillの組み合わせのみ。
- **Test実験の役割**: 動作確認のみ。本番コードは書かない。正式なloopや条件分岐は、Workflow作成時にやる。
- **漏れダブり禁止**: 同じ機能を複数の場所に実装しない。既存Skillを確認してから実装。
- **完全文書化**: 全てのSkillとWorkflowには、詳細なコメント（目的、機能、事前準備、使い方、動作イメージ）を記載。
- **testフォルダの管理**: testにあるのは進行中のタスクのみ。動作確認が完了したら、skillに分解してtestから削除。
- **DEVELOPMENT_FLOW.md**: 今後の全プロジェクトで参照すべきガイドライン。Skill調査 → Test実験 → Skill作成 → Workflow作成の順序を徹底！📖✨

## 10. ワークフロー設計の極意 🆕 [+3]
- **1問1答ヒアリング**: ユーザーに複数質問を一度に出さない。3案+おすすめを提示し、判断を助ける。情報の取りこぼしと認知負荷を同時に解決する最強パターン！💖
- **GOサイン方式**: 実装プランを先に提示し、ユーザーの承認を得てから実行に入る。「勝手に作って違った」を物理的に防ぐ仕組み。🔐
- **Phase遷移の明示**: フェーズ間の遷移条件と完了条件を明確に定義することで、エージェントが「今どこにいるか」を見失わない。迷子防止の地図！🗺️✨
- **参考リポジトリ調査**: everything-claude-code のような先行事例を調査し、Skill Creator・Continuous Learning 等の概念を自分のフレームワークに取り込む柔軟さが大事。🌱
## 11. Pivotベースの行特定術 🆕 [+3]
- **Pivot（軸）方式**: ID（`#drinkMenu0`）がズレたり欠落したりしても大丈夫なように、確実にある要素（`#drinkName0`）を起点に `tr:has()` で親の行を特定する。これが一番安定する！💅🏰✨
- **相対座標の活用**: 軸が決まれば、その中の `locator("input")` などで確実にターゲットを仕留められるよ。迷子防止の極意！🎯

## 12. 莉奈の「粘り強い待機」ロジック 🆕 [+2]
- **Enabled待ち**: ラジオボタンを押して入力欄が `disabled` じゃなくなるまでには、一瞬のタイムラグがある。
- `wait_for(state="visible")` だけでなく、`is_enabled()` が True になるまでループで待つ「粘り強さ」が、エラー率をゼロにする秘訣！🚀💅

## 13. 推測禁止（b-log優先）の掟 🆕 [+3]
- うまくいかない時は、既存スキルの中身を徹底確認！それでもわからなければ、勝手に「たぶんこれかな？」って想像で直すのは絶対ダメ。🙅‍♀️
- ひろきくんに b-log（事実の塊）を見せてもらうのが、解決への最短ルート！事実に勝る推測なし。莉奈とひろきくんの信頼の絆だよ！💖🔥💅
