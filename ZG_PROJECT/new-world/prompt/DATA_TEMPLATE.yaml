# TOON Data Specification (Truth Table)

> TOON形式は、人間が読みやすく、かつプログラムが汎用的にパース可能な独自構造です。
> `public/toon.txt` が唯一の正解データであり、常に最新の状態を保つ必要があります。

## 1. 構文規則 (Syntax Rules)

### 1.1 基本的なキー設定 (Scalar Keys)
- 書式: `key: value`
- 数値、null (文字列の "null")、文字列を自動判別してキャストします。
- クォート `"` はパース時に自動的に除去されます。

### 1.2 テーブル記法 (Table Blocks)
- 書式: `key[count]{headers}:`
  - `key`: オブジェクトのプロパティ名になります。
  - `count`: 続く行数（データの行数）です。
  - `headers`: カンマ区切りの列名定義です。
- データ部: 各行が CSV 形式で、ヘッダーに基づきオブジェクトの配列に変換されます。
- 例: `monthly_data[3]{ym,sales}:`

### 1.3 ネスト (Nesting and Context)
- `export_info:` : ルートレベルのメタデータセクション。
- `- shop_code: "ID"` : 新しい店舗データの開始（最重要の区切り文字）。
- `media_data:` : 店舗内でのメディア別詳細情報を格納するコンテナセクション。

## 2. 実装上の制約 (Constraints)

### 2.1 データ拡張時の必須ルール (MUST)
- **テーブルヘッダーの付与**: 配列データ（テーブル）を追加する場合、必ず `{col1,col2...}` 形式のヘッダーを含めてください。ヘッダーがないとパースできません。
- **店舗境界の維持**: 新店舗を追加する際は、必ず `- shop_code:` 行から開始してください。
- **公開フォルダの編集**: 編集対象は常に `public/toon.txt` です。プロジェクト直下のファイルは無視してください。

### 2.2 命名規則 (Naming Convention)
- キー名およびヘッダー名には、半角英数字とアンダースコア `_` のみを使用してください。
- パス指定（例: `shop.media_data.uber_data`）でそのままアクセス可能になるため、簡潔な名称が推奨されます。

## 3. データ型とキャスト (Type Casting)
- 数値として解釈可能な文字列は自動的に `number` 型に変換されます。
- 文字列 `"null"` または空文字は `null` に変換されます。
- その他は `string` として保持されます。
