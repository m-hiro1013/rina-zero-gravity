# 🛠 デバッグ・プロトコル (Debugging Protocol)

> ミスを繰り返さない。データこそが唯一の真実。

## 🚨 デバッグの鉄則

1.  **「あてずっぽう」の禁止** 🚫
    *   原因を特定しないまま、コードを適当に動かして修正を試みるのは「下手な鉄砲」であり、厳禁とする。
    *   推測ではなく、必ず**証拠（ログやデータ）**に基づいて行動すること。

2.  **二重検証（Double-Check Fail）時のフロー** 🔄
    *   一度行った修正が失敗し、再度バグや意図しない挙動（数値0など）が発生した場合、**直ちにコード編集を中断**する。
    *   以下の「データ駆動デバッグ」の手順へ強制移行すること。

## 📊 データ駆動デバッグの手順

1.  **ログの挿入**: 疑わしいデータの入り口（Parserなど）や計算ロジックに `console.log` を追加する。
2.  **型の可視化**: 単なるオブジェクト出力ではなく、`JSON.stringify(obj, null, 2)` などを使用して、型（文字か数字か）や中身を完全に可視化する。
3.  **ユーザー確認**: ログの内容をユーザーに提示し、現状の「事実」を共有する。
4.  **原因特定**: ログを見て「なぜそうなっているのか」の根本原因を特定する。
5.  **最小修正**: 特定された根本原因に対して、最小かつ最適な修正を行う。

## 💡 今回の教訓（2026-02-19）

- **CSVパースの罠**: JSON文字列（`"{"key": "val"}"`）が含まれるCSVをパースする際、単純なカンマ分割や正規表現では不十分。エスケープされた引用符（`\"`）を考慮したステートフルなパースが必要。
- **型の統一**: 識別子（ID、年月、店舗コード）は、数値計算に使わないならば Parser の時点で **String型に固定** し、UI側から統一的に扱えるようにすること。
