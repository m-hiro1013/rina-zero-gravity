---
description: Commitパターンに対応するワークフローテンプレートの定義。Orchestratorがワークフロー設計に使用する。
---

# ワークフローテンプレート定義 (Workflow Templates)

> パターンが決まれば、ワークフローが決まる

## 概要

**ワークフローテンプレート**とは、各Commitパターンに対応する標準的な実行計画。
Orchestratorはパターン分類後、対応するテンプレートを選択してワークフローを設計する。

---

## テンプレート1: 新規開発ワークフロー（New Development Workflow）

**対応パターン**: 新規開発

### 構成

```
┌─────────────────────────────────────────────────────────────┐
│ 初期フェーズ（1回のみ）                                        │
├─────────────────────────────────────────────────────────────┤
│ 1. 要件定義 → 2. 環境構築                                    │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 反復フェーズ（N回繰り返し）                                    │
├─────────────────────────────────────────────────────────────┤
│ 最小開発 → テスト → デバッグ → 完了 → セルフチェック → 記憶の管理 │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ ユーザー確認                                                 │
├─────────────────────────────────────────────────────────────┤
│ 現状報告 → 継続判断を仰ぐ                                     │
└─────────────────────────────────────────────────────────────┘
```

### 反復回数の見積もり

| 規模 | 判定基準 | 反復回数 |
|------|---------|---------|
| **小** | 1ファイル、単機能、シンプルなUI | 3サイクル |
| **中** | 複数ファイル、3-5機能、標準的なアプリ | 5サイクル |
| **大** | 多数ファイル、複雑な機能、フルアプリ | 10サイクル |

### ユーザー確認ポイント
- 見積もりサイクル完了後
- 重大エラー発生時
- 設計方針の変更が必要な場合

---

## テンプレート2: 修正・改善ワークフロー（Fix / Improvement Workflow）

**対応パターン**: 修正・改善

### 構成

```
┌─────────────────────────────────────────────────────────────┐
│ 初期フェーズ（1回のみ）                                        │
├─────────────────────────────────────────────────────────────┤
│ 1. 現状把握 → 2. 影響範囲特定                                 │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 反復フェーズ（N回繰り返し）                                    │
├─────────────────────────────────────────────────────────────┤
│ 最小開発 → テスト → デバッグ → 完了 → セルフチェック → 記憶の管理 │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ ユーザー確認                                                 │
├─────────────────────────────────────────────────────────────┤
│ 修正完了報告 → 追加修正の確認                                  │
└─────────────────────────────────────────────────────────────┘
```

### 反復回数の見積もり

| 規模 | 判定基準 | 反復回数 |
|------|---------|---------|
| **小** | 単一箇所の修正、影響範囲が限定的 | 1サイクル |
| **中** | 複数箇所に影響、関連テストあり | 2サイクル |
| **大** | 設計変更を伴う、広範囲に影響 | 3サイクル |

### ユーザー確認ポイント
- 修正完了後
- 影響範囲が想定より大きい場合
- 追加修正が必要な場合

---

## テンプレート3: 情報取得ワークフロー（Information Retrieval Workflow）

**対応パターン**: 情報取得

### 構成

```
┌─────────────────────────────────────────────────────────────┐
│ 初期フェーズ（1回のみ）                                        │
├─────────────────────────────────────────────────────────────┤
│ 1. 質問の構造化                                              │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 反復フェーズ（1回）                                           │
├─────────────────────────────────────────────────────────────┤
│ 調査 → 整理 → 回答作成 → セルフチェック → 記憶の管理           │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 回答提示                                                    │
├─────────────────────────────────────────────────────────────┤
│ ユーザーへ回答を提示                                          │
└─────────────────────────────────────────────────────────────┘
```

### 反復回数の見積もり
- **常に1サイクル**（追加質問があれば新規Commitとして扱う）

### ユーザー確認ポイント
- 回答提示後（追加質問の有無を確認）

---

## テンプレート4: セッション管理ワークフロー（Session Management Workflow）

**対応パターン**: セッション管理

### 構成

```
┌─────────────────────────────────────────────────────────────┐
│ 反復フェーズ（1回）                                           │
├─────────────────────────────────────────────────────────────┤
│ 状態確認 → 実行（開始/再開/保存/終了） → 記憶の管理            │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 完了報告                                                    │
├─────────────────────────────────────────────────────────────┤
│ セッション状態をユーザーに報告                                 │
└─────────────────────────────────────────────────────────────┘
```

### サブタイプ

| サブタイプ | 実行内容 |
|-----------|---------|
| **開始** | prompt/フォルダ確認 → 新規作成 or 既存読み込み |
| **再開** | WORKFLOW.yaml読み込み → 状況サマリー提示 |
| **保存** | WORKFLOW.yaml更新 → 進捗記録 |
| **終了** | 保存 + 次回タスク記録 |

### 反復回数の見積もり
- **常に1サイクル**

---

## テンプレート選択フロー

```
Commitパターン判定
        │
        ├─ 新規開発 ────→ テンプレート1
        │
        ├─ 修正・改善 ──→ テンプレート2
        │
        ├─ 情報取得 ────→ テンプレート3
        │
        └─ セッション管理 → テンプレート4
```

---

## 反復回数見積もりのルール

### 規模判定基準

| 指標 | 小 | 中 | 大 |
|------|---|---|---|
| ファイル数 | 1-2 | 3-10 | 10+ |
| 機能数 | 1 | 3-5 | 5+ |
| 外部依存 | なし | 1-2 | 3+ |
| 複雑度 | シンプル | 標準 | 複雑 |

### 見積もり調整

Orchestratorは以下の情報からより精度の高い見積もりを行う：

1. ユーザーの具体的な要求内容
2. 技術スタックの複雑さ
3. 類似プロジェクトの過去実績（goku.md参照）
4. 明示的な制約や要件

---

## テンプレートのカスタマイズ

テンプレートはデフォルト設計であり、以下の場合にカスタマイズ可能：

1. ユーザーが明示的にフェーズをスキップ指示
2. 対象が既にテスト済みでテストフェーズ不要
3. 緊急対応でセルフチェックを簡略化

**ただし**: 記憶の管理フェーズは**スキップ禁止**。

---

## Orchestratorへの指示

1. Commitパターンを判定
2. 対応するテンプレートを選択
3. 規模を判定し、反復回数を見積もり
4. ユーザー確認ポイントを設定
5. ワークフロー実行を開始
