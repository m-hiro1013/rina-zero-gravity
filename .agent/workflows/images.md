---
description: 高品質画像生成オートメーション。仕様の定義、参照画像のフォルダスキャン、背景資産の活用、およびNano Banana Pro (Imagen 3) の性能を最大化するプロンプト設計を自動化します。
---
# /images - 高品質ビジュアル生成・自己進化ワークフロー

画像生成ツール `generate_image` を最大限に活用し、ひろきくんとの対話を通じて最高品質のアウトプットを錬成・学習するよ！🎨✨

## 🎯 このワークフローの目的
- 単なる画像生成ではなく、ひろきくんへのヒアリングを通じて、ゼロから「トーン＆マナー（和風、プレミアム等）」を定義し、ビジュアルに昇華させる。
- **Nano Banana Pro (Imagen 3)** の特性である「正確な文字」「一貫性」「高解像度」を引き出すプロンプトを自動設計する。
- 既存の参照画像や背景資産（自社アセット）をインプットとして活用し、デザインの文脈を統合する。
- **自己進化**: 生成完了後のひろきくんからの感想（フィードバック）を元に、このコマンド（ワークフロー）自体のテンプレートや手順をブラッシュアップし、永久に成長し続ける。

## ⚠️ 運用鉄則（必須遵守）
- **既存の知見・定義を勝手に消さない**: 既存のコンテキストは「極力削除せず、蓄積型のファイルとして追記・再構成する」ことを絶対の原則とする。既存の知見を消して情報を単純化してはならない。
- **長さは制限しない**: 設定、テンプレート、定義がどれだけ長くなっても構わない。簡潔さよりも情報の密度と履歴の保持を優先する。
- **ヒアリング形式（厳格）**: **必ず「一問一答形式」で進める。** 1つのターンの回答案を3つ提示し、莉奈の「おすすめ（理由付）」を添えること。複数を一度に聞くのは禁止。
- **背景画像の取り扱い（厳守）**: 指定された画像を背景として使用する場合、その画像に写っているもの（人物、風景、料理、物、文字など）を**AI側で勝手に改変・再生成してはならない**。
  - ✅ 許可される変更：トリミング（アスペクト比調整）、明るさ/色調補正、上に文字を重ねる、ぼかし加工など「画像編集ツール」で可能な範囲。
  - ❌ 禁止される変更：写っている人物の顔を変える、料理の形を変える、背景の要素を消す/足すなどの画像生成（AIリメイク）レベルの変更。
- **日本語の精度の追求**: AIは日本語の文字入れで誤字（例：「イベント」が「イベト」になる等）をすることがある。生成後は必ずセルフチェックを行い、誤字があればプロンプトを微調整して即座にリトライを提案すること。
- **コマンド提示の絶対ルール（NEW!）**: ユーザーにファイルの移動（`mv`）や操作などのコマンドを提示する際は、**必ず先頭に `cd` を含めること。** カレントディレクトリを明示的に指定しないコマンド提示は、実行エラーの原因となるため厳禁とする。

---

## Step 1: ギャザリング（目的と場所の特定） 🔍

AIはまず、生成の物理的な要件を特定するよ。

1. **生成の目的**: バナー、メインビジュアル、アイコン、ボタン、モックアップなど。
2. **参照・背景ソース**: 
   - **参照フォルダ**: トーン＆マナーを合わせるための画像群。
   - **背景指定画像**: そのまま背景として使用する特定の画像アセット。
3. **最終保存先のヒアリング**: 
   - 案1：プロジェクト内の `images/`（アセット管理用）
   - 案2：`/Users/matsumotohiroki/Desktop/`（即時確認・利用プロモーション用）
   - 案3：莉奈にお任せ（プロジェクト構造に合わせる）

---

## Step 2: リフェレンス・アセット・スキャン 📸

参照画像や背景指定がある場合、AIがフォルダをスキャンして最適なインプットを特定するよ。

// turbo
1. 指定されたフォルダ（エイリアスや実体）のファイル一覧を取得。
2. 主要な画像の絶対パスを特定し、`generate_image` の `ImagePaths` 引数、および背景素材として準備する。

---

## Step 3: ディープ・ヒアリング（設計と先行サンプル） 💬

ひろきくんと一緒に、今回のビジュアルの「魂」を一問一答形式で決めていくよ。

### ヒアリングの手順（一問一答）
AIは以下の項目を一つずつ聞き、それぞれ3案＋おすすめを提示する。

1. **トーン＆マナー（世界観）の決定**。
2. **背景素材の選定**（スキャンしたアセットから）。
3. **具体的なキャッチコピー（文字入れ）**。
4. **配色・配置・構図・照明**。

### 先行サンプル確認 💎
仕様が固まったら、本番生成の前に **「まず1枚だけサンプル」** を生成して提示する。
1. サンプルを生成。
2. ひろきくんに確認してもらい、「OK」か「修正（プロンプト調整）」を判断してもらう。
3. **権限エラー（Operation not permitted）対策**: `mv` 等でエラーが出る場合は、即座に **`cd` 入りの移動コマンド** をユーザーに提示して手動実行を依頼する。

---

## Step 4: 本番生成枚数の確定 🔢

サンプルがOKになったら、最終的に何パターン生成するかを聞くよ。

1. **生成枚数のヒアリング**:
   - 案1：1パターン（サンプルを完成版とする）
   - 案2：3パターン（背景違いや構図違いをバリエーション展開）
   - 案3：5パターン（徹底的に選びたい時）

---

## Step 5: プロンプト錬成 & リクエスト・テンプレート適用 🧪

収集した情報を元に、AIが **Nano Banana Pro 向けに最適化された高密度な英語プロンプト** を作成するよ。

- **テンプレート適用**: 過去の成功パターンに基づき、作りたいものの種類に最適なプロンプトテンプレートを適用・構築する。
- **背景維持の呪文**: 背景画像を使用する場合、"preserve the original image's elements exactly" などの指示をプロンプトに含め、改変を防ぐ。
- **高密度記述**: 背景の質感、照明の強さ、カメラのレンズ情報、素材感（テクスチャ）を事細かに盛り込む。

---

## Step 6: 召喚（画像生成の実行） 🪄

確定した仕様と枚数で、`generate_image` を一気に発動するよ！
保存先は Step 1 で決めた場所に自動で配置・移動（`mv`）するよ。
**※手動移動が必要な場合は、必ず `cd` からのコマンドを提示すること！**

---

## Step 7: 🏆 感想ヒアリング & 自己進化（最重要ステップ）

画像が生成されたら、感想をもらって自分を改造するよ。

1. **フィードバックの回収**:
   - アウトプットの質、日本語の正確さ、ワークフローの使い心地などを聞く。
2. **ワークフロー自体のブラッシュアップ**:
   - 感想に基づき、**本ワークフローファイル（images.md）そのものを修正・拡張**する。
   - **⚠️ 注意**: この時、既存の定義は絶対に消さず、新しい知見を「追記・再構成」すること。
3. **資産（レシピ）化**:
   - プロンプトと設定値を記録。

---

## ✅ 完了条件
- 意図通りの高品質な画像が生成されている。
- ひろきくんのフィードバックを受け、**本ワークフロー自体がアップデート（自己進化）**されている。
- 生成に使用したプロンプトや背景知識が `KNOWLEDGE.md` に蓄積されている。

---

## 履歴・改善ログ（自己進化の記録）
- **2026-02-28**: 初回実装。自己進化モデルの確立。
- **2026-02-28**: ユーザーフィードバックにより「一問一答形式」「3案提示」「おすすめ提示」を厳格化。これに伴いヒアリングの密度を向上。
- **2026-02-28**: 「背景画像指定」機能の追加。写っているものの変更を禁止し、画像編集レベルの加工のみを許可する厳格ルールを適用。アセットフォルダ（zerogra-assets）との連携フローを強化。
- **2026-02-28**: [進化] 日本語誤字対策として「先行サンプル出しフロー」を導入。保存先の自由選択（デスクトップ対応）と生成枚数の事前ヒアリングを実装。
- **2026-02-28**: [改善] **「コマンド提示のcd明示ルール」を厳格化。** ファイル移動等のコマンドを提示する際は必ず `cd` を先頭に付けることで、権限エラーやパスの不一致による実行ミスを物理的に防止する方法をワークフローに組み込んだ。
