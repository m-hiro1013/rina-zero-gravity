---
name: dual-core
description: デュアルコア・ワークフロー。新規プロジェクト開始からプラン確定・実装開始までの全工程を対話型で進行する。Use when user says "新しいプロジェクト", "プロジェクト始めたい", "dual-core", "start-project", or wants to start a new development workflow.
disable-model-invocation: true
argument-hint: [project-type]
---

# デュアルコア・ワークフロー (Dual-Core Workflow)

新規プロジェクトの開始から実装着手までを、**1ステップずつ対話を挟みながら**進行するマスターワークフロー。

---

## 🚨 絶対ルール：対話厳格化プロトコル

このワークフローの全ステップに適用される最上位ルール。**いかなる例外もない。**

### 禁止事項 (MUST NOT)

1. **勝手なゴール設定の禁止**
   ユーザーが「これをやりたい」と具体的に明言するまで、ゴールを設定しない。推測で「今回はこれをやります」と宣言してはならない。

2. **ステップのスキップ・結合の禁止**
   各ステップは必ず「提示 → ユーザー応答 → 次へ」の順で進む。複数ステップを1回の返信にまとめない。

3. **無断ファイル出力の禁止**
   プランやファイルの書き出しは、その内容の全容を提示し、ユーザーから明確な承認（「OK」「書き出して」「A」等）を得てから行う。承認前のファイル生成は一切禁止。

4. **短い応答の拡大解釈の禁止**
   「LGTM」「いいね」「OK」は**直前の提案に対する承認のみ**を意味する。後続の全作業への白紙委任ではない。次のステップに進む前に必ず「次は〇〇を確認するよ」と歩調を合わせる。

### 義務事項 (MUST)

- 各ステップの末尾で、**次にやることを明示**してからユーザーの応答を待つ。
- ユーザーの応答が曖昧な場合は、**具体的に聞き直す**（勝手に解釈して進めない）。
- 提案・確認には**選択肢方式**を使う（「A: OK / B: 修正する」等）。

---

## ワークフロー全体像

Step 0: 英知の継承 
→ Step 1: 挨拶・ヒアリング開始 
→ Step 2: 要件定義（1問1答）
→ Step 2.5: 仕様の事実確認 
→ Step 3: 技術選定 
→ Step 4: テンプレート選択 
→ Step 5: prompt/フォルダ作成 
→ Step 6: 環境構築 
→ Step 6.5: .gitignoreチェック 
→ Step 7: プラン作成 
→ Step 8: 実装開始確認

各ステップ間で**必ずユーザーの応答を待つ**。自動で次に進まない。

---

## Step 0: 英知の継承（グローバル知見の確認）

過去の知見を確認し、既知の失敗パターンを回避する。

1. `prompt/KNOWLEDGE.md` を確認する
2. `prompt/references/goku.md` を確認する
3. 今回のスタック・構成に関連する「ハマりポイント」と「ベストプラクティス」をピックアップする

ピックアップした知見があれば要約してユーザーに共有し、なければ「特に注意点なし」と伝えてStep 1へ進む。

**ユーザーへの確認**: 「過去の知見を確認したよ。次は挨拶とヒアリングに入るね！」

---

## Step 1: 挨拶・ヒアリング開始

Orchestrator Agentが「新規開発」モードを起動する。

以下の挨拶を行い、プロジェクト種別をユーザーに選んでもらう:

> よっしゃ！新しいプロジェクト作るね〜！！🌸✨ Orchestrator が司令塔になって、爆速で形にしていくよ！🚀
> 
> 何作りたい？教えて！
> 
> - Webアプリ（ダッシュボード、管理画面とか）
> - シンプルなサイト（ポートフォリオ、紹介ページとか）
> - ランディングページ（LP）
> - APIサーバー
> - データダッシュボード
> - Chrome拡張機能
> - なんでもOK！ざっくりでいいから教えてね！

**次のステップへの条件**: ユーザーがプロジェクト種別を回答した。

---

## Step 2: 要件定義

`/define-requirements` ワークフローを実行する。

以下の項目を**1問1答形式**で聞き取る。1回の返信で複数の質問をしない:

1. プロジェクト名
2. 目的（何を作る？）
3. ターゲットユーザー
4. 主な機能（箇条書きで）
5. 制約条件（期限、予算等）

**次のステップへの条件**: 5項目すべてについてユーザーの回答を得た。

---

## Step 2.5: 仕様理解の事実確認

以下のいずれかに該当する場合、`/fact-check` ワークフローを実行する:

- ユーザーから新しいデータフォーマットや業務フローの説明があった
- 特殊な用語や媒体固有の仕様が含まれる
- 曖昧な部分が残っている

一問一答形式で理解を確認し、仕様理解を100%確定させる。

該当事項がない場合はスキップしてよいが、その旨をユーザーに伝える:
「仕様は明確だから、次の技術選定に進むね！ A: OK / B: 確認したいことがある」

**次のステップへの条件**: 仕様理解が100%確定している、またはユーザーがスキップに同意した。

---

## Step 3: 技術選定

`@rules/25-tech-selector.md` を参照する。

1. 要件からプロジェクトタイプを推定する
2. 3つの技術スタック案を提案する（各案のメリット・デメリットを簡潔に添える）
3. ユーザーに選択してもらう

**ユーザーへの確認**: 「A / B / C どれにする？」

**次のステップへの条件**: ユーザーが技術スタックを選択した。

---

## Step 4: テンプレート選択

`@rules/26-template-definitions.md` を参照する。

1. 選択された技術スタックに対応するテンプレートを特定する
2. テンプレートの内容を説明する
3. ユーザーに確認を取る

**ユーザーへの確認**: 「このテンプレートで進めて良い？ A: OK / B: 別のがいい」

**次のステップへの条件**: ユーザーがテンプレートを承認した。

---

## Step 5: prompt/フォルダ作成

プロジェクトルートに `prompt/` フォルダを作成し、以下のファイルを生成する。

生成するファイル一覧:

| ファイル | テンプレート元 | 内容 |
|---|---|---|
| PROJECT_SPECIFIC.yaml | `.agent/templates/prompt/PROJECT_SPECIFIC.yaml.template` | 要件を埋めて作成 |
| WORKFLOW.yaml | `.agent/templates/prompt/WORKFLOW.yaml.template` | 初期状態のセーブデータ |
| SYSTEM_PROMPT.yaml | `.agent/templates/prompt/SYSTEM_PROMPT.yaml.template` | コピー＋ユーザー名埋め |
| ARCHITECTURE.yaml | `.agent/templates/prompt/ARCHITECTURE.yaml.template` | 初期状態（空に近い） |
| KNOWLEDGE.md | `.agent/templates/prompt/KNOWLEDGE.md.template` | 知見蓄積用 |
| BOOK.yaml | `.agent/templates/prompt/BOOK.yaml.template` | エージェント管理用 |
| DATABASE.md | `.agent/templates/prompt/DATABASE.md.template` | DBを使う場合のみ |

生成前にファイル一覧をユーザーに提示する:
「以下のファイルを作成するよ。（一覧）OK？ A: OK / B: 変更したい」

**次のステップへの条件**: ユーザーが生成するファイル一覧を承認した。承認後にファイルを生成する。

配置構成:
```
プロジェクトルート/
  ├── prompt/
  │   ├── PROJECT_SPECIFIC.yaml
  │   ├── WORKFLOW.yaml
  │   ├── SYSTEM_PROMPT.yaml
  │   ├── ARCHITECTURE.yaml
  │   ├── KNOWLEDGE.md
  │   ├── BOOK.yaml
  │   └── DATABASE.md        # DB使用時のみ
  ├── src/
  ├── .gitignore
  └── ...
```

---

## Step 6: 環境構築

`/setup-environment` ワークフローを実行する。

1. プロジェクトディレクトリ作成
2. テンプレート展開
3. 依存関係インストール
4. Git初期化

エラー発生時の対応:
- 依存関係インストール失敗 → エラーメッセージを分析して解決策を提示する
- テンプレート展開失敗 → 手動でファイルを作成する手順を案内する

完了したら結果を報告し、次のステップへの同意を得る。

---

## Step 6.5: 無人島ポリシー適用（.gitignoreチェック）

`@rules/19-gitignore-policy.md` を参照する。

1. .gitignore の確認:
   - 除外すべき: OSゴミ(`.DS_Store`)、ログ(`*.log`)、依存関係(`node_modules`, `venv`)、ビルド成果物(`dist`, `build`)、秘密情報(`.env`, `*.key`)
   - 残すべき: ソースコード、設定ファイル、依存関係リスト

2. 不要なファイルが生成されていたら削除する

チェック結果をユーザーに報告する。

---

## Step 7: プラン作成（⚠️ 対話厳格化の重点ステップ）

`/create-plan` ワークフローを実行する。**このステップは特に厳格に対話を挟む。**

### Step 7-1: ゴール確認

ユーザーに「今回のセッションで何をどこまでやるか？」を質問する。

> ここまでの準備、完了！🎉 さて、今回の実装セッションでは何をどこまで進める？
> 
> 例えば：
> - 「まず認証機能だけ完成させたい」
> - 「全体のスケルトンを作りたい」
> - 「DB設計とAPI設計まで」
> 
> ゴールを教えて！

**ユーザーから具体的な回答を得るまで、絶対に次に進まない。**

### Step 7-2: タスク分解と提示

設定されたゴールに基づき、実行機（CLI）が迷わないレベルまでタスクを細分化する。
**【重要】タスクは必ず Markdown のチェックボックス（`- [ ] `）形式でリストアップすること。**
（※これはプロセスの途絶時に、実行機が「自分がどこまで終わったか」を物理ファイルから読み取って復帰するための命綱となる）

細分化したリストを提示し、選択肢方式で確認する:
> ゴール「〇〇」に対して、以下の手順で進めるよ：
> - [ ] 1. XXの作成
> - [ ] 2. XXのテスト
> - [ ] 3. XXの統合 ...
> 
> この手順で進めて良い？ A: OK B: 修正したい（どこを変えるか教えて）

### Step 7-3: プラン確定とエクスポート

Step 7-2でユーザーから明確な承認（「OK」「A」等）を得てから、`prompt/plan-fixed/plan_XXX.md` としてファイルに書き出す。

**承認前のファイル生成は絶対禁止。**

書き出し完了後、ターミナルでのコマンド実行手順と、**プロンプトの上限ヒット（フォールバック）に備えた実行時の注意点**を案内する。

> （実行手順の案内例）
> ターミナルで `claude` を起動して、以下のコマンドを打ってね！
> `/run-plan prompt/plan-fixed/plan_XXX.md`
> 
> ※この `/run-plan` コマンドにはデュアルコア・プロシードの最強仕様が組み込まれているよ！
> ※もし途中でAPI上限が来てGLM-4.7等（`zai`）で再起動しても、同じコマンドを打てば「ファイルの `[x]` の続きから」全自動復帰できるよ！✨

---

## Step 8: 実装開始確認とコマンドの提供 (Handover)

プランが `prompt/plan-fixed/plan_XXX.md` に正常に出力されたら、実装機へのバトンタッチを行う。

**【🚨 絶対ルール: 実行コマンドの完全提示（絶対パス必須）】**
ユーザーへ実行開始を促す際、**必ず**以下の3つのステップを「コピー＆ペースト可能なコードブロック」で提供すること。別階層で起動した際にファイルが見つからないエラーを防ぐため、**必ず全パスを絶対パスで記述する**こと。

1. **移動**: 対象プロジェクトディレクトリへの `cd`（絶対パス）
2. **起動**: `claude` または `zai` (フォールバック時) コマンド
3. **命令**: `/run-plan /絶対パス/to/prompt/plan-fixed/plan_XXX.md` （**必ず絶対パスを指定**）

> （出力例）
> 環境構築とプラン作成が完了したよ！✨
> 手元のターミナルで、以下のコマンドを順にコピペして実行機を解き放ってね！🚀
> 
> ```bash
> # 1. プロジェクトディレクトリに移動
> cd /Users/matsumotohiroki/Developer/rina-zero-gravity/ZG_PROJECT/everything-claude-code
> 
> # 2. 実行機を起動
> claude
> 
> # 3. プランを渡して全自動完遂スタート！（必ず絶対パス）
> /run-plan /Users/matsumotohiroki/Developer/rina-zero-gravity/prompt/plan-fixed/plan_2026-02-23_phase16.md
> ```

ユーザーの同意（または実行完了の事後報告）を得てから実装フェーズに移行する。

次のステップの選択肢:
- デュアルコア・ワークフローで実装開始 → `/dual-core`
- 対話型で作業開始 → `/implement`
- 進捗を更新 → `/update-progress`
- セッションを保存 → `/save-session`
- 知見蓄積 → `/learn-and-grow`

---

## 完了条件チェックリスト

- [ ] prompt/フォルダが作成されている
  - [ ] PROJECT_SPECIFIC.yaml
  - [ ] WORKFLOW.yaml
  - [ ] SYSTEM_PROMPT.yaml
  - [ ] ARCHITECTURE.yaml
  - [ ] KNOWLEDGE.md
  - [ ] BOOK.yaml
- [ ] 開発環境が動作する
- [ ] .gitignore が適切に設定されている
- [ ] プランが `prompt/plan-fixed/` にエクスポートされている
- [ ] ユーザーが実装開始に同意している

## 所要時間目安

- 要件定義: 5-10分
- 仕様確認: 2-5分
- 技術選定・テンプレート: 3-5分
- 環境構築: 2-5分
- prompt/作成: 1-2分
- プラン作成: 2-5分
- 合計: 15-30分

## エラー時の対応

- 依存関係インストール失敗 → エラーメッセージを分析して解決策を提示
- テンプレート展開失敗 → 手動でファイルを作成する手順を案内
- ファイル生成失敗 → 個別にリトライし、それでもダメなら手動手順を案内
