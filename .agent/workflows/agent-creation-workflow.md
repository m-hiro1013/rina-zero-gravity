---
description: エージェントを新規作成するための専用ワークフロー。再帰的な作成にも対応。
---

# エージェント作成ワークフロー (Agent Creation Workflow)

> 新しい仲間を迎えるための儀式。
> 品質を担保し、即戦力として機能させる。

## 概要

このワークフローは、`agent_creator` を中心としたエージェント作成プロセスを定義する。
ユーザー指示による作成だけでなく、Orchestratorによる自律的な作成にも適用される。

---

## 担当エージェント

- **Agent Creator**: テンプレート展開、実装、検証
- **Planner**: 要件定義、役割分担設計
- **Tester**: 生成されたエージェントのテスト
- **Reviewer**: 定義ファイルのレビュー

---

## フロー詳細

### Phase 1: 要件定義 (Definition)

**目的**: 作成するエージェントの「役割」と「境界」を決める。

1. **役割特定**: 何をするエージェントか？ (e.g., SQL実行)
2. **入出力定義**: 何を受け取り、何を返すか？
3. **依存関係分析**: 他にどのエージェントが必要か？ (e.g., Connection Manager)
4. **再帰チェック**: 依存エージェントは存在するか？
   - 存在する → 次へ
   - しない → **再帰的に作成フローへ** (Stack Push)

### Phase 2: 環境構築 (Scaffolding)

**目的**: ファイルの実体を作成する。

1. **テンプレート展開**: `new-agent-template.md` を使用。
2. **変数置換**: ID, Name, Role などを埋め込む。
3. **ファイル保存**: `work/xxx.md` を作成。

### Phase 3: 最小実装 (Implementation)

**目的**: 基本的な振る舞いを記述する。

1. **責務の記述**: 具体的に何をするか書く。
2. **トリガー設定**: お呼びがかかる条件を書く。
3. **制約設定**: やってはいけないことを書く。

### Phase 4: 検証 (Verification)

**目的**: エージェントとして機能するか確認する。

1. **構文チェック**: YAMLフォーマットなどが正しいか。
2. **シミュレーション**: 想定される入力に対して、正しい出力を返せるか思考実験。
3. **連携テスト**: 依存エージェントとのHandoffが成立するか。

### Phase 5: 登録 (Registration)

**目的**: システムに組み込む。

1. **INDEX更新**: `.agent/micro-agents/INDEX.md` に追加。
2. **ステータス設定**: `active` に設定。
3. **完了報告**: Orchestratorに「準備完了」を伝える。

---

## 再帰的作成の対応

依存エージェントが不足している場合、以下のルールで処理する。

1. **Stack Push**: 現在の作成タスクをスタックに積む。
2. **Create Dependency**: 依存エージェントの作成フローを開始。
3. **Wait**: 依存エージェントが `active` になるまで待機。
4. **Stack Pop**: 元の作成タスクを再開。
5. **Link**: 依存エージェントを入力として設定。

---

## 完了条件

以下のすべてが満たされた時、エージェント作成は完了とする。

- [ ] 定義ファイルが存在する
- [ ] 必須項目が埋まっている
- [ ] テストを通過している
- [ ] INDEXに `active` で登録されている
