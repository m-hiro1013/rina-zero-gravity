---
trigger: always_on
slug: index-first
inheritance: core
scope: project_local
---
# 目次ファースト原則 (Index-First Principle)

> **「情報にアクセスする前に、必ず目次を見る」**
> これがエージェントの精度と自律性を最大化する鍵。

## 1. なぜ目次ファーストか

### 問題
- 情報が散在 → どこに何があるかわからない
- コンテキストを浪費 → 不要な情報まで読み込む
- 判断精度が低下 → 全体像なしに部分だけ見る

### 解決
```
目次を見る → 必要な情報を特定 → ピンポイントでアクセス
```

これにより：
1. **効率的**: コンテキストウィンドウを節約
2. **合理的**: 全体像を把握した上で判断
3. **安全**: 見落としや重複を防ぐ

---

## 2. INDEX一覧

| INDEX | 場所 | いつ見るか |
|-------|------|-----------|
| **MASTER INDEX** | `.agent/INDEX.md` | 作業開始時 |
| **Rules INDEX** | `.agent/rules/99-index.md` | ルール適用を検討する時 |
| **Workflows INDEX** | `.agent/workflows/INDEX.md` | コマンド実行を検討する時 |
| **Agents INDEX** | `.agent/micro-agents/INDEX.md` | エージェント連携を検討する時 |
| **Files INDEX** | `prompt/FILES.md` | ファイル操作を検討する時 |
| **Knowledge INDEX** | `prompt/KNOWLEDGE.md` | 過去の知見を参照する時 |

---

## 3. 必ず目次を見るタイミング

### 3.1 セッション開始時
```
1. MASTER INDEX を確認
2. プロジェクトの FILES.md を確認
3. WORKFLOW.yaml で前回の状態を確認
```

### 3.2 ルールを適用する前
```
1. Rules INDEX で該当ルールを特定
2. 必要なルールだけを読む
3. 不要なルールは読まない
```

### 3.3 ワークフローを実行する前
```
1. Workflows INDEX で適切なコマンドを特定
2. 類似コマンドがないか確認
3. 依存関係があるか確認
```

### 3.4 エージェントを呼ぶ前
```
1. Agents INDEX で誰を呼ぶか決定
2. 入力・出力を確認
3. 依存するエージェントを確認
```

### 3.5 ファイル操作をする前
```
1. Files INDEX で対象ファイルを特定
2. 依存関係を確認
3. 操作後に Files INDEX を更新
```

### 3.6 知見を参照する前
```
1. Knowledge INDEX でカテゴリを特定
2. 必要なカテゴリだけを読む
3. ウェイト上位を優先
```

---

## 4. INDEXの更新ルール

### 4.1 追加時
ファイル・ルール・ワークフロー・エージェントを追加したら：
1. 該当するINDEXに追記
2. MASTER INDEXの統計を更新（必要に応じて）

### 4.2 削除時
1. 該当するINDEXから削除
2. 依存関係のあるINDEXも確認・更新

### 4.3 変更時
1. 該当するINDEXを更新
2. 依存関係のあるINDEXも確認・更新

---

## 5. アンチパターン

### ❌ やってはいけないこと

1. **目次を見ずにファイルを開く**
   - 必要かどうかわからないまま読み込む
   - コンテキストを浪費

2. **全ルールを読み込む**
   - 30個のルール全部 → 大量のコンテキスト消費
   - 必要なものだけでいい

3. **INDEXを更新しない**
   - ファイルを追加したのにINDEXに反映しない
   - 目次が古くなって意味をなさない

4. **INDEXを飛ばす**
   - 「知ってるから大丈夫」→ 変更があるかもしれない
   - 必ず確認する

---

## 6. 実践例

### 例1: バグ修正を始める時

```
1. MASTER INDEX を見る
   → Workflows INDEX を参照すべきとわかる

2. Workflows INDEX を見る
   → /bug-fix コマンドがあるとわかる
   → /test-debug もあるとわかる

3. /bug-fix ワークフローだけを読む
   → 手順に従って進める

4. Files INDEX を見る
   → 関連ファイルを特定

5. 必要なファイルだけを読む
   → バグを修正
```

### 例2: 新機能を追加する時

```
1. Workflows INDEX を見る
   → /create-feature コマンドを特定

2. Rules INDEX を見る
   → 適用すべきルールを特定
   → 35-type-safety.md, 60-react-components.md など

3. Agents INDEX を見る
   → Orchestrator経由で進めるべきとわかる

4. Files INDEX を見る
   → どこにファイルを追加するか決定

5. 実装後、Files INDEX を更新
```

---

## 7. 格言

> 目次を見ることは、地図を見てから旅に出るようなもの。
> 遠回りせず、確実に目的地に辿り着ける。

> 情報の海で溺れないために、まず目次という灯台を見つける。

> 効率は「何をしないか」で決まる。目次は「読まなくていいもの」を教えてくれる。
