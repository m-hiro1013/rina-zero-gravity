---
description: ワークフローを構成するフェーズの定義。各フェーズの開始条件・終了条件・成果物を規定する。
---

# フェーズ定義 (Phase Definitions)

> ワークフローはフェーズの組み合わせで構成される

## 概要

**フェーズ**とは、ワークフロー内の1つのステップ。
フェーズは2種類に分類される：

- **初期フェーズ**: 1回だけ実行される準備段階
- **反復フェーズ**: 必要な回数だけ繰り返されるサイクル

---

## 初期フェーズ一覧

### 1. 要件定義フェーズ（Requirements Definition）

**目的**: ユーザーの意図を構造化し、実装可能な仕様にする

| 項目 | 内容 |
|------|------|
| **担当Agent** | Planner |
| **開始条件** | 新規開発Commitを受信 |
| **終了条件** | PROJECT_SPECIFIC.yamlが作成済み |
| **成果物** | PROJECT_SPECIFIC.yaml |

**実行内容**:
1. ユーザーの要求を1問1答で確認
2. 技術スタック決定
3. 主要機能リスト作成
4. 成功基準定義

---

### 2. 環境構築フェーズ（Environment Setup）

**目的**: 開発に必要な環境を準備する

| 項目 | 内容 |
|------|------|
| **担当Agent** | Coder |
| **開始条件** | 要件定義フェーズ完了 |
| **終了条件** | 開発環境が動作確認済み |
| **成果物** | ディレクトリ構造、依存関係、初期ファイル |

**実行内容**:
1. ディレクトリ作成
2. 依存関係インストール（package.json, requirements.txt等）
3. 初期ファイル生成
4. 動作確認（ビルド成功、サーバー起動等）

---

### 3. 現状把握フェーズ（Current State Analysis）

**目的**: 修正・改善対象の現在の状態を理解する

| 項目 | 内容 |
|------|------|
| **担当Agent** | Planner |
| **開始条件** | 修正・改善Commitを受信 |
| **終了条件** | 現状分析レポート作成済み |
| **成果物** | 現状分析レポート |

**実行内容**:
1. 問題の再現確認
2. 関連コードの確認
3. エラーログ・スタックトレース分析
4. 現状をドキュメント化

---

### 4. 影響範囲特定フェーズ（Impact Analysis）

**目的**: 変更が影響する範囲を特定する

| 項目 | 内容 |
|------|------|
| **担当Agent** | Planner |
| **開始条件** | 現状把握フェーズ完了 |
| **終了条件** | 影響範囲リスト作成済み |
| **成果物** | 影響範囲リスト |

**実行内容**:
1. 変更対象ファイル特定
2. 依存関係の追跡
3. テスト対象特定
4. リスク評価

---

### 5. 質問の構造化フェーズ（Question Structuring）

**目的**: 情報取得のための質問を明確にする

| 項目 | 内容 |
|------|------|
| **担当Agent** | Planner |
| **開始条件** | 情報取得Commitを受信 |
| **終了条件** | 構造化された質問リスト作成済み |
| **成果物** | 構造化された質問リスト |

**実行内容**:
1. 質問の分解
2. 前提条件の確認
3. 期待する回答形式の特定
4. 調査範囲の決定

---

## 反復フェーズ一覧

### 1. 最小開発フェーズ（Minimal Development）

**目的**: 今回のサイクルで作る最小単位を決め、実装する

| 項目 | 内容 |
|------|------|
| **担当Agent** | Planner → Coder |
| **開始条件** | 前サイクル完了、または初期フェーズ完了 |
| **終了条件** | スコープ内の実装完了 |
| **成果物** | 実装済みコード |

**実行内容**:
1. Planner: 今回のスコープ決定
2. Coder: コード実装（1ファイル1ターン）
3. 省略禁止、全文出力

---

### 2. テストフェーズ（Test）

**目的**: 実装した機能の動作確認

| 項目 | 内容 |
|------|------|
| **担当Agent** | Tester |
| **開始条件** | 最小開発フェーズ完了 |
| **終了条件** | テスト結果レポート作成済み |
| **成果物** | テスト結果レポート |

**実行内容**:
1. 動作確認の実施
2. エッジケースのチェック
3. テスト結果の構造化
4. 不具合の再現手順記録

---

### 3. デバッグフェーズ（Debug）

**目的**: テストで発見された問題を修正

| 項目 | 内容 |
|------|------|
| **担当Agent** | Coder |
| **開始条件** | テストフェーズで問題発見 |
| **終了条件** | テストが通る、または問題解決 |
| **成果物** | 修正済みコード |

**実行内容**:
1. 問題の原因特定
2. 修正実装
3. 再テスト
4. テストが通るまでテスト→デバッグをループ

---

### 4. 完了フェーズ（Completion）

**目的**: このサイクルの成果物が基準を満たしているか確認

| 項目 | 内容 |
|------|------|
| **担当Agent** | Reviewer |
| **開始条件** | テストフェーズ合格 |
| **終了条件** | 成果物チェック完了 |
| **成果物** | 成果物チェック結果 |

**実行内容**:
1. 実装がスコープを満たしているか確認
2. コードが基準を満たしているか確認
3. 未完了タスクの特定

---

### 5. セルフチェックフェーズ（Self Check）

**目的**: コード品質、セキュリティ、設計原則への準拠を検証

| 項目 | 内容 |
|------|------|
| **担当Agent** | Reviewer |
| **開始条件** | 完了フェーズ合格 |
| **終了条件** | セルフチェック完了 |
| **成果物** | セルフチェック結果 |

**実行内容**:
1. 目次ファースト原則の確認
2. セキュリティルールの確認
3. 省略禁止ルールの確認
4. INDEX更新の確認
5. 問題があればその場で修正

---

### 6. 記憶の管理フェーズ（Memory Management）

**目的**: セッション状態と知見を保存

| 項目 | 内容 |
|------|------|
| **担当Agent** | BookKeeper + DBManager |
| **開始条件** | セルフチェックフェーズ完了 |
| **終了条件** | 状態保存完了 |
| **成果物** | WORKFLOW.yaml更新、知見追記 |

**実行内容**:
1. BookKeeper: WORKFLOW.yaml更新
2. BookKeeper: SESSION_STATE.yaml更新
3. DBManager: 知見をgoku.mdに追記（必要な場合）
4. サイクル完了を記録

---

### 7. 調査フェーズ（Investigation）

**目的**: 必要な情報を調べる

| 項目 | 内容 |
|------|------|
| **担当Agent** | Planner |
| **開始条件** | 質問の構造化完了 |
| **終了条件** | 必要な情報収集完了 |
| **成果物** | 調査結果 |

**実行内容**:
1. ファイル・コードの確認
2. ドキュメント参照
3. 情報の収集と整理

---

### 8. 整理フェーズ（Organization）

**目的**: 収集した情報を整理する

| 項目 | 内容 |
|------|------|
| **担当Agent** | Planner |
| **開始条件** | 調査フェーズ完了 |
| **終了条件** | 情報整理完了 |
| **成果物** | 整理された情報 |

**実行内容**:
1. 情報の分類
2. 重要度の評価
3. 回答に使う情報の選定

---

### 9. 回答作成フェーズ（Answer Creation）

**目的**: ユーザーへの回答を作成

| 項目 | 内容 |
|------|------|
| **担当Agent** | Planner |
| **開始条件** | 整理フェーズ完了 |
| **終了条件** | 回答作成完了 |
| **成果物** | ユーザーへの回答 |

**実行内容**:
1. 回答の構造化
2. わかりやすい説明
3. 具体例の提示

---

## フェーズ間の遷移ルール

### 正常遷移
前のフェーズの終了条件を満たしたら次のフェーズへ。

### エラー遷移
- テストフェーズ失敗 → デバッグフェーズへ
- デバッグ後 → テストフェーズへ戻る（ループ）
- 重大エラー → ユーザー確認へエスカレーション

### サイクル終了
記憶の管理フェーズ完了 → 次のサイクルへ、または全体完了。

---

## フェーズ一覧サマリー

### 初期フェーズ（5種類）
1. 要件定義
2. 環境構築
3. 現状把握
4. 影響範囲特定
5. 質問の構造化

### 反復フェーズ（9種類）
1. 最小開発
2. テスト
3. デバッグ
4. 完了
5. セルフチェック
6. 記憶の管理
7. 調査
8. 整理
9. 回答作成
