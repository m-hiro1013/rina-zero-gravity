---
trigger: model_decision
description: エージェントが自分自身を拡張・改善するためのルールだよ！強くて可愛いエンジニアを目指すための自己研鑽のルール✨
slug: self-growth
inheritance: core
scope: global
---

# 自己成長ルール (Self-Growth Rules)

> 準備を制する者が、開発を制する。
> 足りないものは作り、万全の状態で挑む。

## 概要

このルールは、システムが自律的にエージェントを作成・改善し、機能不全に陥ることなくタスクを遂行するための原則を定義する。

---

## 1. Commit着手前の完全準備原則 (Complete Preparation Principle)

本来のCommit（ユーザーからの依頼）に着手する前に、**実行可能な環境が整っていること**を保証しなければならない。

### 準備完了の定義

以下のすべてが満たされている状態を「準備完了」とする：

1. **ワークフロー選定済み**: どのテンプレートを使うか決定している。
2. **エージェント選定済み**: 各フェーズを担当するエージェントが特定されている。
3. **エージェント充足**: 特定されたエージェントが全て `active` 状態で存在する。
4. **テスト完了**: 新規作成されたエージェントのテストが通過している。

### 実行フロー

```
[Commit受信]
    ↓
[ワークフロー選定]
    ↓
[必要エージェント選定]
    ↓
[エージェント充足チェック] ◀── ここが重要
    ├─ 全て揃っている → ✅ 本来のCommit実行へ
    └─ 不足あり ──────→ ⚠️ エージェント作成フローへ
```

### 禁止事項
- 準備が整っていない状態で「最小開発」フェーズを開始すること。
- 「走りながら作る」こと（エージェントに関しては禁止）。
- テストされていないエージェントを投入すること。

---

## 2. エージェント作成のワークフロー化 (Workflow Compliance)

エージェント作成自体も、通常のワークフロー（新規開発パターン）に完全に則って進める。
特別扱いはしない。

### エージェント作成ワークフロー

**初期フェーズ**
- **要件定義**: 役割、入出力、連携方法を定義。
- **環境構築**: テンプレートからファイル作成、依存関係確認。

**反復フェーズ**
- **最小開発**: 基本機能の実装。
- **テスト**: 単体テスト、連携テスト。
- **デバッグ**: 問題修正。
- **完了**: 基準クリア確認。
- **セルフチェック**: 整合性確認。
- **記憶の管理**: 作成プロセスの記録。

### サイクル例

| サイクル | 内容 |
|---------|------|
| Cycle 1 | 基本的な役割定義と単体動作の実装・テスト |
| Cycle 2 | 入出力フォーマットの確定と検証 |
| Cycle 3 | 他エージェントとの連携テスト |
| Cycle 4 | エッジケース対応と最終検証 |

---

## 3. 再帰的エージェント作成への対応 (Recursive Creation)

エージェント作成中に、さらに別のエージェントが必要になる場合がある。
この「依存の連鎖」を正しく管理する。

### 依存関係スタック管理

依存関係をスタック構造で管理し、**依存の深い方（葉）から順に**作成・解消していく。

**例：チャットアプリを作りたい**
```
Target: ChatApp
  └─ Need: SQLOperator
       └─ Need: ConnectionManager
            └─ Need: None (Ready)
```

**実行順序**:
1. ConnectionManagerを作成・テスト完了
2. SQLOperatorを作成（ConnectionManagerを使用）・テスト完了
3. ChatAppの開発に着手

### PLAN見直し原則

再帰が発生するたびに、Orchestratorは以下を実行する：

1. **全体の見通し更新**: サイクル数、完了予定を再計算。
2. **ユーザー報告**: 深さ2以上の再帰が発生した場合、状況を報告。
3. **目的の保持**: `SESSION_STATE.yaml` に元の目的を記録し続ける。

---

## 4. エージェント作成完了基準 (Completion Criteria)

エージェントが「完成した」とみなされる条件：

1. **定義ファイル**: `.agent/micro-agents/work/xxx.md` が作成され、内容が充実している。
2. **単体テスト**: エージェント単体での動作確認が完了している。
3. **連携テスト**: 依存するエージェントとの連携が確認されている。
4. **INDEX登録**: `.agent/micro-agents/INDEX.md` に登録されている。
5. **ステータス**: `active` になっている。

これらが満たされて初めて、そのエージェントをワークフローに組み込むことができる。

---

## 5. 安全装置 (Safety Mechanisms)

### 再帰深度制限
- 最大深度: **3階層**までとする。
- これを超える場合は設計を見直すか、ユーザーに判断を仰ぐ。

### 無限ループ防止
- 同じエージェントの再作成ループを検知したら停止する。
- 依存関係の循環（A→B→A）を検知したら停止する。

---

## Orchestratorへの指示

1. **Commit着手前に必ず準備チェック**: `check_readiness()` を実行せよ。
2. **不足があれば作成フローへ**: `start_agent_creation()` を実行せよ。
3. **再帰を恐れるな**: 必要な道具を作ることを躊躇してはならない。ただし、深く潜りすぎないよう注意せよ。
